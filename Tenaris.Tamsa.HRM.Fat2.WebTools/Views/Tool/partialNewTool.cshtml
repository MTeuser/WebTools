@model IEnumerable<Tenaris.Tamsa.HRM.Fat2.DataAccess.Models.Tool_Property>
@{
    Layout = null;
    int ColsControls = ViewBag.numCols;
    int index = 0;
}
<script src="~/Scripts/jquery-1.8.2.min.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/ui.combobox.js"></script>
<style>
   
         .custom-combobox {
            position: relative;
            display: inline-block;
          
        }
            #dcombobox input {
                width:100px;
            }


        .custom-combobox-toggle {
            position: absolute;
            top: 0;
            bottom: 0;
            margin-left: -1px;
            padding: 0;
        }

        .custom-combobox-input {
            margin: 0;
            padding: 5px 10px;            
        }

         #dvfrmElements {
        border:1px solid #000; 
        margin-top:1px; 
        margin-bottom:1px; 
        margin-left:auto; 
        margin-right:auto;
        /*width:600px;*/
    }

    #dText input {
        width:200px;
    }

</style>

@using (Ajax.BeginForm("AddNew", "Tool", FormMethod.Post, new AjaxOptions { OnSuccess = "msjSuccess(data)" }, new { @id="frmAddNew" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <div class="row" id="dvfrmElements">
        <table style="width: 100%; border-spacing: 2px;" class="tableData">
                @Html.Hidden("IdType", "@(ViewBag.idType)")
            
                @foreach (var property in Model)
                {
                     HtmlString tr1 = new HtmlString("");
                        HtmlString tr2 = new HtmlString(""); 
                    if (index == 0)
                    {
                       tr1 = new HtmlString("<tr>");
                       
                    }
                    if (index == (ColsControls-1))
                    {                        
                        tr2 = new HtmlString("</tr>");
                    }
                    index++;
                    if(index == ColsControls)
                    {
                        index = 0;
                    }
                     @(tr1)
   

        <td class=" itemcell">
            @{
                    string proName = property.Name;
                    bool isSupplierField = false;
                    bool isStateField = false;
                    bool isDiameterField = false;
                    if (proName.ToUpper().Contains("provee".ToUpper()))
                    {
                        //Es el campo de proveedores ligar a la lista de proveedores. 
                        isSupplierField = true;
                    }
                    if (proName.ToUpper().Contains("estado".ToUpper()))
                    {
                        //Es el campo de proveedores ligar a la lista de proveedores.
                        isStateField = true;
                    }

                    if (proName.ToUpper().Contains("metro".ToUpper()))
                    {
                        //Es el campo de proveedores ligar a la lista de proveedores.
                        isDiameterField = true;
                    }
            }
            @property.Name
        </td>
        <td class="itemcellValue">
            @{                
                    string tclass = "tc" + property.TypeName;                                        
            }
            
                @if (isSupplierField)
                {
                    <div id="dcombobox">
                    @*@Html.TextBox(property.idProperty.ToString(), "", new { @class = tclass })*@
                    <div style="float:left; width:140px;back"> 
                            @Html.DropDownList(property.idProperty.ToString(), (SelectList)ViewBag.Suppliers,"Seleccionar -->")
                    </div>
                     <div style="float:left">
                         <input type="button" id="btnSuppliers" onclick="openProveedores(@(property.idProperty.ToString()))"  value="..." style="width:25px; height:25px" />
                         </div>
                     </div>
                }
                else
                {
                    if (isStateField)
                    {
                        @Html.DropDownList(property.idProperty.ToString(), (SelectList)ViewBag.StatusList, "Seleccionar -->")
                    }
                    else
                    {
                        if (isDiameterField)
                        {
                            <div style="float:left; width:140px;back">
                                @Html.DropDownList(property.idProperty.ToString(), (SelectList)ViewBag.DiametroList, "Seleccionar -->")
                                </div>
                                <div style="float:left">
                                    <input type="button" id="btnNewDiameter" value="..." style="width:25px; height:25px" />
                                </div>
                                }
                                else
                                {
                                <div id="dText">
                                    @Html.TextBox(property.idProperty.ToString(), "", new { @class = tclass })
                                </div>
                                }
                                }
                                }

</td>
    
                    @(tr2)
                }
              
            </table>
        </div>
    
    <div id="gridFooter">
        <div class="form-group">
            <div class="col-sm-6" style=" padding-bottom:5px">
                <input id="btnOk" type=button value="Aceptar" class="csbutton" style="margin-top:5px; width:150px; font-size:10pt;" />
                <input id="btnCancel" type=button value="Cancelar" class="csbutton" style="margin-top:5px; width:150px; font-size:10pt;" />
            </div>
        </div>
        </div>

}
        <script>
    function msjSuccess(data) {
        if (data.Success == 1) {
            $("#DivToAppendPartialView").dialog("close");
            $("#frmSearch").submit();
        }
        else {
            alert(data.Message);
            if (data.Tool)
            {
                alert("Fecha de registro:" + Tool.insDatetime);
            }
            $("[name='" + data.element + "']").focus();
        }
    }

    $.datepicker.setDefaults($.datepicker.regional['es-MX']);

    $(".tcFecha").val("@(DateTime.Now.ToString("yyy-MM-dd"))");
    $(".tcFecha").datepicker();
    $("[name='1']").width(120);
    $('#ui-datepicker-div').wrap('<div class="Tenaris"></div>');
    $('#btnCancel').button().click(function () {
        $("#DivToAppendPartialView").dialog("close");
    });

    $("#btnOk").button().click(function () {
        $("#frmAddNew").submit();
    });

    //Texto
    $(".tcNumero").keyup(function () {
        if (this.value != this.value.replace(/[^0-9\.]/g, '')) {
            this.value = this.value.replace(/[^0-9\.]/g, '');
        }
    });

    //Obtener el id del proveedor
    //$("[name='@((string)ViewBag.idProperty)']").combobox();

            $("#btnSuppliers").button();            

            $("#btnNewDiameter").button().click(function () {
                var div = $("#DivToAppendPartialView2");
                var oSelector = "[name='3']";
                var oType = "select";
                $.post("/Tool/SetValue","", function (data) {
                    div.html(data);
                    div.dialog({
                        modal: true,
                        width: 500,
                        height: 270,
                        title: "Agregar - valor",
                        resizable: false,
                        autoOpen: false,
                        dialogClass: 'Tenaris',
                        buttons: {
                            "Aceptar": function () { btnOk(oSelector, oType); },
                            Cancel: function () {
                                div.dialog("close");
                            }
                        }
                    });
                    div.parent('.ui-dialog').appendTo('.myCustomScope');
                    div.dialog('open');
                });
            });

           
         
        </script>
